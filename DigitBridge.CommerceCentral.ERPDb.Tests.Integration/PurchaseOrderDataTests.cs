

//-------------------------------------------------------------------------
// This document is generated by T4
// It will overwrite your changes, please keep it as it is
// <copyright company="DigitBridge">
//     Copyright (c) DigitBridge Inc.  All rights reserved.
// </copyright>
//-------------------------------------------------------------------------
using System;
using System.Collections.Generic;
using System.Linq;
using System.Runtime.CompilerServices;
using System.Text;
using System.Threading.Tasks;
using Microsoft.Extensions.Configuration;
using Xunit;
using DigitBridge.CommerceCentral.YoPoco;
using DigitBridge.Base.Utility;
using DigitBridge.CommerceCentral.XUnit.Common;
using Bogus;

namespace DigitBridge.CommerceCentral.ERPDb.Tests.Integration
{
    public partial class PurchaseOrderDataTests
    {
        List<long> itemsCounts = new List<long>();

        [Fact()]
        //[Fact(Skip = SkipReason)]
        public async Task AddLargeData_Test()
        {
            var inventories = InventoryDataTests.GetInventories(DataBaseFactory, 10002, 10003);
            for (int i = 1; i < 1000; i++)
            {
                var data = await GetFakerDataAsync(10002, 10003, i * 10, inventories);
                if (data == null) break;

                data.SetDataBaseFactory(DataBaseFactory);
                var success = await data.SaveAsync();
                Assert.True(success, "Save po error");
            }

        }


        public async Task<PurchaseOrderData> GetFakerDataAsync(int masterAccountNum, int profileNum, int itemCount, Inventory[] inventories)
        {

            if (itemCount > inventories.Length)
                itemCount = inventories.Length;

            if (itemsCounts.Contains(itemCount)) return null;

            itemsCounts.Add(itemCount);

            var vendorData = await VendorDataTests.AddAsync(DataBaseFactory, masterAccountNum, profileNum);

            var PurchaseOrderData = new PurchaseOrderData();
            PurchaseOrderData.PoHeader = PoHeaderTests.GetFakerData().Generate();
            PurchaseOrderData.PoHeader.MasterAccountNum = masterAccountNum;
            PurchaseOrderData.PoHeader.ProfileNum = profileNum;
            PurchaseOrderData.PoHeader.PoNum = $"{DateTime.Now.ToString("yyyyMMddHHMMss")}_PoWithItemCount_{itemCount}";
            PurchaseOrderData.PoHeader.VendorCode = vendorData.Vendor.VendorCode;
            PurchaseOrderData.PoHeader.VendorName = vendorData.Vendor.VendorName;
            PurchaseOrderData.PoHeader.VendorUuid = vendorData.Vendor.VendorUuid;

            PurchaseOrderData.PoHeaderInfo = PoHeaderInfoTests.GetFakerData().Generate();
            PurchaseOrderData.PoHeaderAttributes = PoHeaderAttributesTests.GetFakerData().Generate();
            PurchaseOrderData.PoItems = PoItemsTests.GetFakerData().Generate(itemCount);

            for (int i = 0; i < itemCount; i++)
            {
                var item = PurchaseOrderData.PoItems[i];
                item.PoItemsAttributes = PoItemsAttributesTests.GetFakerData().Generate();
                item.PoItemsRef = PoItemsRefTests.GetFakerData().Generate();
                var inventory = inventories[i];

                item.SKU = inventory.SKU;
                item.ProductUuid = inventory.ProductUuid;
                item.InventoryUuid = inventory.InventoryUuid;
                item.PriceRule = inventory.PriceRule;
                item.Price = new Random().NextDouble().ToDecimal();
                item.WarehouseCode = inventory.WarehouseCode;
                item.WarehouseUuid = inventory.WarehouseUuid;
            }

            return PurchaseOrderData;
        }
    }
}



